#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>   // Для функцій isalnum (перевірка на букву/цифру)
#include <stdbool.h> // Для типу bool

// =========================================================
// ПРОТОТИПИ ФУНКЦІЙ
// =========================================================

// Функція перевіряє, чи є зчитаний токен "словом" згідно з умовою
bool isValidWord(const char *word);

// Головна функція виконання завдання
void countWordsInFile(const char *filename);

// =========================================================
// ГОЛОВНА ФУНКЦІЯ (Main)
// =========================================================

int main() {
    // Встановлення кодування (опціонально, для Windows)
    system("chcp 1251 > nul");

    char filename[100];

    printf("Введіть ім'я файлу (наприклад, text.txt): ");
    scanf("%99s", filename);

    // Виклик функції підрахунку
    countWordsInFile(filename);

    // Затримка екрану
    printf("\nНатисніть Enter, щоб вийти...");
    getchar(); // Поглинає попередній Enter
    getchar(); // Чекає нового натискання

    return 0;
}

// =========================================================
// РЕАЛІЗАЦІЯ ФУНКЦІЙ
// =========================================================

void countWordsInFile(const char *filename) {
    FILE *fp = fopen(filename, "r");
    
    // Перевірка, чи вдалося відкрити файл
    if (fp == NULL) {
        printf("\n[ПОМИЛКА] Не вдалося відкрити файл '%s'.\n", filename);
        printf("Переконайтеся, що файл існує в папці з програмою.\n");
        return;
    }

    char buffer[1024]; // Буфер для зчитування одного слова
    int totalWords = 0;

    printf("\n--- Початок аналізу файлу ---\n");

    // fscanf зчитує текст, розділений пробілами, табуляцією або новими рядками
    while (fscanf(fp, "%1023s", buffer) == 1) {
        // Перевіряємо, чи є цей набір символів словом
        if (isValidWord(buffer)) {
            totalWords++;
            // Для відлагодження можна розкоментувати рядок нижче, щоб бачити, що програма вважає словом:
            // printf("Слово #%d: %s\n", totalWords, buffer);
        } else {
            // printf("Пропущено (тільки пунктуація): %s\n", buffer);
        }
    }

    fclose(fp);

    printf("\nРезультат: У файлі знайдено %d слів.\n", totalWords);
}

// Функція повертає true, якщо в рядку є хоча б одна буква або цифра
bool isValidWord(const char *word) {
    for (int i = 0; word[i] != '\0'; i++) {
        // isalnum повертає істину, якщо символ є буквою (A-Z) або цифрою (0-9)
        if (isalnum((unsigned char)word[i])) {
            return true; // Знайшли букву або цифру -> це слово
        }
    }
    // Якщо цикл закінчився, а букв/цифр не знайшли -> це просто набір знаків пунктуації
    return false;
}
